
services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: memorypal_backend:latest
    container_name: memorypal_backend
    ports:
      - "8000:8000"
    env_file:
      - ./backend/.env
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: memorypal_frontend:latest
    container_name: memorypal_frontend
    # map host port 80 to container port 8080 (frontend dev server listens on 8080)
    ports:
      - "80:8080"
    # frontend will determine API base at runtime (tries localhost then EC2 IP)
    depends_on:
      - backend
    restart: unless-stopped

# Notes:
# - Place a `.env` file in `backend/` with COHERE_API_KEY and any other env vars.
# - If your frontend Dockerfile serves on another port (e.g. 5173), change the "80:80" mapping accordingly.
# - To run locally or on EC2 (with Docker installed): `docker-compose up -d --build` in repo root.
